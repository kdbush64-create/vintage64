<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vintage64TX | Business Logs</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <div class="terminal-overlay"></div>
    
    <div class="container">
        <div class="theme-switch-wrapper">
            <button id="theme-toggle" aria-label="Toggle between light and dark mode">TOGGLE_VISUAL_MODE</button>
        </div>

        <header>
            <div class="logo-container">
                <img src="logo.png" alt="Vintage64 Logo" class="main-logo">
            </div>
            <h1>SYSTEM_UPDATES</h1> 
            <nav class="system-nav">
                <a href="index.html">[ HOME ]</a>
                <a href="business.html">[ BUSINESS ]</a>
                <a href="logs.html">[ LOGS ]</a>
                <a href="contact.html">[ CONTACT ]</a>
            </nav>
        </header>

        <div id="log-container">
            <p class="blink">SCANNING_FOR_LOG_FILES...</p>
        </div>

        <footer>
            <p class="blink">_ SYSTEM_STABLE // STANDBY_FOR_NEW_LOGS</p>
        </footer>
    </div>

    <script>
        // 1. THEME TOGGLE LOGIC
        const toggleBtn = document.getElementById('theme-toggle');
        if (localStorage.getItem('theme') === 'light') {
            document.documentElement.setAttribute('data-theme', 'light');
        }
        toggleBtn.addEventListener('click', () => {
            let currentTheme = document.documentElement.getAttribute('data-theme');
            let newTheme = (currentTheme === 'light') ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });

        // 2. DATA-BLUE AUTO-HIGHLIGHTER LOGIC
        function highlightProfessionalLabels(targetElement) {
            const keywords = [
                "LOG_DATE:",
                "STATUS:",
                "SUMMARY:",
                "PROJECT:",
                "MILESTONE:",
                "COMPLETED:",
                "PENDING:"
            ];
            
            const walk = document.createTreeWalker(targetElement, NodeFilter.SHOW_TEXT, null, false);
            let node;
            const nodesToReplace = [];

            while (node = walk.nextNode()) {
                keywords.forEach(keyword => {
                    if (node.nodeValue.includes(keyword)) {
                        nodesToReplace.push({node, keyword});
                    }
                });
            }

            nodesToReplace.forEach(({node, keyword}) => {
                const parent = node.parentNode;
                if (parent.closest('.highlight-blue')) return;

                const parts = node.nodeValue.split(keyword);
                const fragment = document.createDocumentFragment();

                parts.forEach((part, index) => {
                    fragment.appendChild(document.createTextNode(part));
                    if (index < parts.length - 1) {
                        const span = document.createElement('span');
                        span.className = 'highlight-blue';
                        span.textContent = keyword;
                        fragment.appendChild(span);
                    }
                });
                parent.replaceChild(fragment, node);
            });
        }

        // 3. LOG FETCHING LOGIC (With Highlighter Integration)
        async function loadLogs() {
            const container = document.getElementById('log-container');
            const user = "kdbush64-create"; 
            const repo = "vintage64"; 
            
            try {
                // Ensure this points to your business-specific folder
                const response = await fetch(`https://api.github.com/repos/${user}/${repo}/contents/business-logs`);
                const files = await response.json();
                container.innerHTML = ''; 

                const mdFiles = files.filter(f => f.name.endsWith('.md')).reverse();

                for (let file of mdFiles) {
                    const res = await fetch(file.download_url);
                    const content = await res.text();

                    const parts = content.split('---');
                    let displayTitle = file.name;
                    let displayDate = "";
                    let body = content;

                    if (parts.length >= 3) {
                        const header = parts[1];
                        body = parts.slice(2).join('---');
                        const tMatch = header.match(/title:\s*(.*)/);
                        const dMatch = header.match(/date:\s*(.*)/);
                        if (tMatch) displayTitle = tMatch[1];
                        if (dMatch) displayDate = dMatch[1];
                    }

                    const entry = document.createElement('section');
                    entry.className = 'log-entry';
                    entry.innerHTML = `
                        <h2>> ${displayTitle}</h2>
                        <p><strong>LOG_DATE:</strong> ${displayDate}</p>
                        <div class="log-text">${marked.parse(body)}</div>
                        <hr style="border: 0; border-top: 1px dashed var(--border); margin: 20px 0;">
                    `;
                    
                    // Trigger highlighting for THIS specific entry
                    highlightProfessionalLabels(entry);
                    
                    container.appendChild(entry);
                }
            } catch (e) {
                container.innerHTML = '<p>ERROR: UPLINK_FAILURE</p>';
                console.error(e);
            }
        }
        
        loadLogs();
    </script>
</body>
</html>
