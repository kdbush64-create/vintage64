<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vintage64TX | System Logs</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="favicon-64.png">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <div class="terminal-overlay"></div>
    
    <div class="container">
        <div class="theme-switch-wrapper">
            <button id="theme-toggle" aria-label="Toggle between light and dark mode">TOGGLE_VISUAL_MODE</button>
        </div>

        <header>
            <div class="logo-container">
                <img src="logo.png" alt="Vintage64 Logo" class="main-logo">
            </div>
            <h1 style="line-height: 1.2; text-align: left; margin-bottom: 20px;">
                <span style="display: block;">VINTAGE64TX</span>
                <span style="display: block; font-weight: normal; font-size: 0.8em; color: var(--text-color); opacity: 0.9;">SYSTEM LOGS</span>
            </h1>
            <nav class="system-nav">
                <a href="index.html">[ HOME ]</a>
                <a href="business.html">[ BUSINESS ]</a>
                <a href="logs.html">[ LOGS ]</a>
                <a href="contact.html">[ CONTACT ]</a>
            </nav>
        </header>

        <div id="log-container">
            <p class="blink">SCANNING_FOR_LOG_FILES...</p>
        </div>

        <footer>
            <div class="footer-status">
                <p>Root Directory: <a href="https://www.facebook.com/kdbush64" class="footer-link">fb://kdbush64</a></p>
                <p style="font-size: 0.75em; opacity: 0.7; margin-top: 15px; border-top: 1px dashed rgba(0,255,0,0.2); padding-top: 10px;">
                    SYSTEM_VER: 1.0.2-BETA | STATUS: <span style="color: #00ff00;">STABLE</span> | LAST_UPDT: <span id="last-update">FETCHING...</span>
                </p>
                <p style="font-size: 0.7em; opacity: 0.5;">Â© 2026 VINTAGE64TX // ALL RIGHTS RESERVED</p>
            </div>
        </footer>
    </div>

    <script>
        // 1. THEME TOGGLE LOGIC
        const toggleBtn = document.getElementById('theme-toggle');
        if (localStorage.getItem('theme') === 'light') {
            document.documentElement.setAttribute('data-theme', 'light');
        }
        toggleBtn.addEventListener('click', () => {
            let currentTheme = document.documentElement.getAttribute('data-theme');
            let newTheme = (currentTheme === 'light') ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });

        // 2. GITHUB LAST UPDATE AUTO-FETCH (Footer Update)
        async function fetchLastUpdate() {
            try {
                const response = await fetch('https://api.github.com/repos/kdbush64-create/vintage64/commits/main');
                const data = await response.json();
                const date = new Date(data.commit.author.date);
                document.getElementById('last-update').textContent = date.toISOString().split('T')[0];
            } catch (error) {
                document.getElementById('last-update').textContent = "2026-02-11";
            }
        }
        fetchLastUpdate();

        // 3. DATA-BLUE AUTO-HIGHLIGHTER LOGIC
        function highlightProfessionalLabels(targetElement) {
            const keywords = [
                "LOG_DATE:", "STATUS:", "SUMMARY:", "PROJECT:", "MILESTONE:", "COMPLETED:", "PENDING:", "VIGILANCE:", "INTEL_TYPE:"
            ];
            
            const walk = document.createTreeWalker(targetElement, NodeFilter.SHOW_TEXT, null, false);
            let node;
            const nodesToReplace = [];

            while (node = walk.nextNode()) {
                keywords.forEach(keyword => {
                    if (node.nodeValue.includes(keyword)) {
                        nodesToReplace.push({node, keyword});
                    }
                });
            }

            nodesToReplace.forEach(({node, keyword}) => {
                const parent = node.parentNode;
                if (parent.closest('.highlight-blue')) return;

                const parts = node.nodeValue.split(keyword);
                const fragment = document.createDocumentFragment();

                parts.forEach((part, index) => {
                    fragment.appendChild(document.createTextNode(part));
                    if (index < parts.length - 1) {
                        const span = document.createElement('span');
                        span.className = 'highlight-blue';
                        span.textContent = keyword;
                        fragment.appendChild(span);
                    }
                });
                parent.replaceChild(fragment, node);
            });
        }

        // 4. LOG FETCHING LOGIC
        async function loadLogs() {
            const container = document.getElementById('log-container');
            const user = "kdbush64-create"; 
            const repo = "vintage64"; 
            
            try {
                const response = await fetch(`https://api.github.com/repos/${user}/${repo}/contents/business-logs`);
                const files = await response.json();
                container.innerHTML = ''; 

                const mdFiles = files.filter(f => f.name.endsWith('.md')).reverse();

                for (let file of mdFiles) {
                    const res = await fetch(file.download_url);
                    const content = await res.text();

                    const parts = content.split('---');
                    let displayTitle = file.name;
                    let displayDate = "";
                    let body = content;

                    if (parts.length >= 3) {
                        const header = parts[1];
                        body = parts.slice(2).join('---');
                        const tMatch = header.match(/title:\s*(.*)/);
                        const dMatch = header.match(/date:\s*(.*)/);
                        if (tMatch) displayTitle = tMatch[1];
                        if (dMatch) displayDate = dMatch[1];
                    }

                    const entry = document.createElement('section');
                    entry.className = 'log-entry';
                    entry.style.marginBottom = '40px';
                    entry.innerHTML = `
                        <h2 style="color: var(--accent);">> ${displayTitle}</h2>
                        <p><strong>LOG_DATE:</strong> ${displayDate}</p>
                        <div class="log-text" style="line-height: 1.6;">${marked.parse(body)}</div>
                        <hr style="border: 0; border-top: 1px dashed var(--border); margin: 20px 0;">
                    `;
                    
                    highlightProfessionalLabels(entry);
                    container.appendChild(entry);
                }
            } catch (e) {
                container.innerHTML = '<p>ERROR: UPLINK_FAILURE // CHECK_REPOSITORY_PATH</p>';
                console.error(e);
            }
        }
        
        loadLogs();
    </script>
</body>
</html>
