<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vintage64 | Business Logs</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <div class="terminal-overlay"></div>
    
    <div class="container">
        <div class="theme-switch-wrapper">
            <button id="theme-toggle" aria-label="Toggle between light and dark mode">TOGGLE_VISUAL_MODE</button>
        </div>

        <header>
            <div class="logo-container">
                <img src="logo.png" alt="Vintage64 Logo" class="main-logo">
            </div>
            <h1>SYSTEM_UPDATES</h1> 
            <nav class="system-nav">
                <a href="index.html">[ HOME ]</a>
                <a href="business.html">[ BUSINESS ]</a>
                <a href="logs.html">[ LOGS ]</a>
                <a href="contact.html">[ CONTACT ]</a>
            </nav>
        </header>

        <div id="log-container">
            <p class="blink">SCANNING_FOR_LOG_FILES...</p>
        </div>

        <footer>
            <p class="blink">_ SYSTEM_STABLE // STANDBY_FOR_NEW_LOGS</p>
        </footer>
    </div>

    <script>
        // 1. THEME TOGGLE LOGIC (Restored)
        const toggleBtn = document.getElementById('theme-toggle');
        if (localStorage.getItem('theme') === 'light') {
            document.documentElement.setAttribute('data-theme', 'light');
        }
        toggleBtn.addEventListener('click', () => {
            let currentTheme = document.documentElement.getAttribute('data-theme');
            let newTheme = (currentTheme === 'light') ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });

        // 2. LOG FETCHING LOGIC (The "Engine")
        async function loadLogs() {
            const container = document.getElementById('log-container');
            const user = "kdbush64-create"; 
            const repo = "vintage64"; 
            
            try {
                const response = await fetch(`https://api.github.com/repos/${user}/${repo}/contents/business-logs`);
                const files = await response.json();
                container.innerHTML = ''; 

                const mdFiles = files.filter(f => f.name.endsWith('.md')).reverse();

                for (let file of mdFiles) {
                    const res = await fetch(file.download_url);
                    const content = await res.text();

                    const parts = content.split('---');
                    let displayTitle = file.name;
                    let displayDate = "";
                    let body = content;

                    if (parts.length >= 3) {
                        const header = parts[1];
                        body = parts.slice(2).join('---');
                        const tMatch = header.match(/title:\s*(.*)/);
                        const dMatch = header.match(/date:\s*(.*)/);
                        if (tMatch) displayTitle = tMatch[1];
                        if (dMatch) displayDate = dMatch[1];
                    }

                    const entry = document.createElement('section');
                    entry.className = 'log-entry'; // Uses your existing CSS styling
                    entry.innerHTML = `
                        <h2>> ${displayTitle}</h2>
                        <p><strong>LOG_DATE:</strong> ${displayDate}</p>
                        <div class="log-text">${marked.parse(body)}</div>
                        <br>
                    `;
                    container.appendChild(entry);
                }
            } catch (e) {
                container.innerHTML = '<p>ERROR: UPLINK_FAILURE</p>';
            }
        }
        loadLogs();
    </script>
</body>
</html>
